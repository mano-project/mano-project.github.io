<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" translate="no" class="notranslate">
    <head>
        <title>MANO - Metadata Collection</title>
        <meta name="keywords" content="MANO, Manuscripts Online, Metadata Collection">
        <meta name="description" content="">
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 shrink-to-fit=no"/>
        <meta name="google" content="notranslate"/>
        <link rel="canonical" href="https://burchards-dekret-digital.de"/>
        <link rel="icon" type="image/png" href="images/MANO.png"> 
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
               
        <link rel="stylesheet" type="text/css" href="css/style.css" media="screen"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    </head>
    <body>
        <nav class="navbar bg-body-tertiary ">
            <div class="container-fluid d-flex justify-content-between align-items-center position-relative py-2">

                <!-- Invisible spacer to balance layout -->
                <div style="width: 80px;"></div>

                <!-- Centered logo -->
                <div class="position-absolute start-50 translate-middle-x text-center">
                <a class="navbar-brand" href="index.html">
                    <img src="images/MANO.png" alt="Logo" width="80" class="d-inline-block align-text-top">
                </a>
                </div>

                <!-- Offcanvas toggle aligned right -->
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
                aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>

                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">&lt;MANO&gt;</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="resources.html">Resources</a></li>
                    <li class="nav-item"><a class="nav-link" href="editor.html">Metadata Editor</a></li>
                    <li class="nav-item"><a class="nav-link active" href="collection.html">Metadata Collection</a></li>
                    <li class="nav-item"><a class="nav-link" href="viewer.html">Transcription Viewer</a></li>
                    <!--<li class="nav-item"><a class="nav-link" href="contacts.html">Contacts</a></li>-->
                    </ul>
                </div>
                </div>
            </div>
        </nav>
        <div class="d-flex flex-column min-vh-100">
        <div class="container container-page mt-4 mb-5 flex-grow-1">
            
          <div class="container">
            <button onclick="history.back()" class="btn btn-sm btn-outline-secondary">&larr; Back</button>
          </div>
          <h1 class="page-title">Metadata Collection</h1>

          <div class="row my-4 align-items-end">
          <!-- Left column -->
          <div class="col-12 col-md-6 d-flex justify-content-start mb-2 mb-md-0">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#infoMetadataCollection">
              About Metadata Collection
            </button>
          </div>

          <!-- Right column -->
          <div class="col-12 col-md-6 d-flex justify-content-start justify-content-md-end">
            <a href="https://github.com/mano-project/mano-metadata/tree/main/data" 
              class="btn btn-primary" 
              target="_blank" 
              rel="noopener noreferrer">
              Contribute to the Collection <i class="fab fa-github fa-xl ms-2"></i>
            </a>
          </div>
        </div>


          <!-- About Metadata Editor Modal -->
          <div class="modal fade" id="infoMetadataCollection" tabindex="-1" aria-labelledby="infoMetadataCollectionLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="infoMetadataCollectionLabel">About Metadata Collection</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p>The Metadata Collection provides an overview of all manuscript descriptions that have been contributed by users into the MANO project repository. Each row in the table represents a single manuscript, with metadata such as title, repository, location, material, and links to digital copies. The filtering interface allows the metadata to be refined by country, century, responsible person, or by searching titles and repositories.</p>
                  <p>To contribute new metadata, manuscripts must first be described in the <a href="editor.html">Metadata Editor</a> and downloaded in JSON format. The resulting JSON file can then be uploaded directly to the <a href="https://github.com/mano-project/mano-metadata/tree/main/data" target="_blank">MANO GitHub repository</a>, or by clicking the "Contribute to the Collection" button on this page. After the submission is reviewed and accepted by the project team, the new records will automatically appear in this collection.
                  </p>
                  <p>Contributors must have a GitHub account in order to submit files directly. Alternatively, metadata files may be sent via email to the project team, who will handle the upload process. Every contribution helps expand the shared digital resource, and participation in enriching the Metadata Collection is greatly appreciated.
                  </p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

  <!-- Filters -->
  <div class="row mb-4 mt-5">
    <div class="col-md-3">
      <input id="searchInput" class="form-control" type="text" placeholder="Search title or repository..." oninput="filterTable()">
    </div>
    <div class="col-md-3">
      <select id="countryFilter" class="form-select" onchange="filterTable()">
        <option value="">All Countries</option>
      </select>
    </div>
    <div class="col-md-3">
      <select id="centuryFilter" class="form-select" onchange="filterTable()">
        <option value="">All Centuries</option>
      </select>
    </div>
    <div class="col-md-3">
      <select id="personFilter" class="form-select" onchange="filterTable()">
        <option value="">All Responsible Persons</option>
      </select>
    </div>
  </div>

  <!-- Table -->
  <table class="table table-striped" id="metadataTable">
    <thead>
      <tr>
        <th>Title</th>
        <th>Repository</th>
        <th>Location</th>
        <th>Material</th>
        <th>Digital Copy</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Rows added by JS -->
    </tbody>
  </table>
</div>

<footer class="footer bg-body-tertiary text-center py-4">
  <div class="container">

  <!-- Logo centered -->
  <div class="mb-3">
      <a class="navbar-brand" href="index.html">
      <img src="images/MANO.png" alt="Logo" width="80">
      </a>
  </div>

  <!-- Links centered in one line -->
  <div class="mb-3">
      <a class="footer-link mx-2" href="index.html">Home</a>
      <a class="footer-link mx-2" href="resources.html">Resources</a>
      <a class="footer-link mx-2" href="editor.html">Metadata Editor</a>
      <a class="footer-link mx-2" href="collection.html">Metadata Collection</a>
      <a class="footer-link mx-2" href="viewer.html">Transcription Viewer</a>
      <!--<a class="footer-link mx-2" href="contacts.html">Contacts</a>-->
  </div>

  <!-- Copyright centered -->
  <div class="text-center mt-2">
      <span>Â© 2025 <span class="mano">&lt;MANO&gt;</span></span>
  </div>

  </div>
</footer>
</div>
<script>
const repoOwner = "mano-project";
const repoName = "mano-metadata";
const folderPath = "data";

let allEntries = [];

async function fetchFileList() {
  const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;
  const res = await fetch(apiUrl);
  const files = await res.json();
  return files.filter(file => file.name.endsWith(".json"));
}

async function fetchJSONFile(url) {
  const res = await fetch(url);
  return await res.json();
}

function getCentury(yearStr) {
  const year = parseInt(yearStr);
  if (isNaN(year)) return null;
  return Math.floor((year - 1) / 100) + 1;
}

function createTableRow(entry) {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${entry.msTitle || ""}</td>
    <td>${entry.repository || ""}</td>
    <td>${entry.settlementIdent || ""}, ${entry.countryIdent || ""}</td>
    <td>${entry.material || ""}</td>
    <td>${entry.digi ? `<a href="${entry.digi}" target="_blank">View</a>` : ""}</td>
  `;
  row.dataset.country = entry.countryIdent || "";
  row.dataset.century = getCentury(entry.dateOrigin) || "";
  row.dataset.persons = (entry.responsiblePersons || [])
    .map(p => `${p.name} ${p.surname}`.toLowerCase())
    .join(";");
  row.dataset.text = `${entry.msTitle || ""} ${entry.repository || ""}`.toLowerCase();
  return row;
}

function populateFilters(entries) {
  const countries = new Set();
  const centuries = new Set();
  const persons = new Set();

  entries.forEach(entry => {
    if (entry.countryIdent) countries.add(entry.countryIdent);
    const c = getCentury(entry.dateOrigin);
    if (c) centuries.add(`C.${c}`);
    (entry.responsiblePersons || []).forEach(p => {
      persons.add(`${p.surname}, ${p.name}`);
    });
  });

  const addOptions = (selectId, values) => {
    const select = document.getElementById(selectId);
    values = Array.from(values).sort();
    values.forEach(v => {
      const option = document.createElement("option");
      option.value = v;
      option.textContent = v;
      select.appendChild(option);
    });
  };

  addOptions("countryFilter", countries);
  addOptions("centuryFilter", centuries);
  addOptions("personFilter", persons);
}

function filterTable() {
  const textFilter = document.getElementById("searchInput").value.toLowerCase();
  const country = document.getElementById("countryFilter").value;
  const century = document.getElementById("centuryFilter").value.replace("C.", "");
  const person = document.getElementById("personFilter").value.toLowerCase();

  document.querySelectorAll("#tableBody tr").forEach(row => {
    const matchesText = row.dataset.text.includes(textFilter);
    const matchesCountry = !country || row.dataset.country === country;
    const matchesCentury = !century || row.dataset.century === century;
    const matchesPerson = !person || row.dataset.persons.includes(person);

    row.style.display = matchesText && matchesCountry && matchesCentury && matchesPerson ? "" : "none";
  });
}

async function loadMetadata() {
  const tableBody = document.getElementById("tableBody");
  const fileList = await fetchFileList();

  for (const file of fileList) {
    try {
      const record = await fetchJSONFile(file.download_url);
      const entries = Array.isArray(record) ? record : [record];
      entries.forEach(entry => {
        allEntries.push(entry);
        const row = createTableRow(entry);
        tableBody.appendChild(row);
      });
    } catch (err) {
      console.error("Error loading file:", file.name, err);
    }
  }

  populateFilters(allEntries);
}

loadMetadata();
</script>
</body>

</html>